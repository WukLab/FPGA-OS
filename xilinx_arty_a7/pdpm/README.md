# PDPM Work-In-Progress

All vivado auto-generated stuff will be inside `generated/` folder. Other folders such as `rtl/`, `hls/` store the real source code. Use Git to track useful source code and vivado rebuild TCL commands. DO not commit unnecessary stuff.

TODO:
- still need to figure out how to git track block design
- and how to track IPs properly

## Run

HLS: go to `hls/`, type `make` to setup projects. Type `make g` to bring up GUI. Export IP before using Vivado.
Vivado: Navigate to `scipts/`, type `make`. A new project will be created at `../generated`.

If bash complains vivado cannot be found, change the absolute path inside Makefile.

## Modules

`top.v` is the top level RTL connects everything. It conneccts the Network and the Memory modules.
The Network module refers to the modified Tri-Mode MAC reference design.
The Memory modules refers to our HLS and memory controller.

## Vivado TCL

Both scripts were generated by Vivado, I did not do too much change other than adding
the `source create_bd.tcl` at the end of `tri_mode_mac.tcl`. The top `tri_mode_mac.tcl`
was created by `write_protect_tcl` before there was a block diagram.

```
write_project_tcl -no_copy_sources -force -target_proj_dir ../generated/pdpm ../scripts/test.tcl
```

If you already have the diagram, you have to add `-use_bd_files`. However, then the generated
TCL file will use those `*.bd` files directly. The thing is, to use block diagram, we actually
need its own script, we don't want those `*bd` to be included.

The `create_bd.tcl` was created by `write_bd_tcl`, and it will be sourced within `tri_mode_mac.tcl`.
Whenever you run `tri_mode_mac.tcl`, the BD will be automatically created. Other `create_bd_*.tcl`
were created in the same way.

Now the `tri_mode_mac.tcl` is already being hacked, you CAN NOT just replace it with a newly generated
one. If you want to make changes, do as follows:

- `Add new files or misc`: manually add the line inside `tri_mode_mac.tcl`. (Maybe you can run `write_protect_tcl`
here to see how new commands look like.)
- `Save modified Block Diagram`: run commands accordingly
	- `write_bd_tcl -bd_folder ../generated/pdpm/bd ../scripts/create_bd.tcl`
	- `write_bd_tcl -bd_folder ../generated/pdpm/bd ../scripts/create_bd_clock.tcl`
